const isAndroid=/android/i.test(navigator.userAgent),SCALING_DURATION=280,Theme=Object.freeze({LIGHT:"light",DARK:"dark"});let theme=Theme.LIGHT;const fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontWeight=isAndroid?400:200;let baseDimensions=updateBaseDimensions(document.body.clientWidth);function updateBaseDimensions(t){const e=t-36;return{windowWidth:t,scrollbarWidth:e,scrollbarPlotWidth:e,scrollbarPlotHeight:55,mainPlotHeight:460}}function round(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}window.addEventListener("resize",()=>{if(document.body.clientWidth===baseDimensions.windowWidth)return;baseDimensions=updateBaseDimensions(document.body.clientWidth);const t=document.querySelectorAll("chart-table");for(let e of t)e.resize()});const MONTH_NAMES=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],WEEK_DAY_NAMES=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function getDateString(t,e=!1){const i=new Date(t),n=i.getDate()+" "+MONTH_NAMES[i.getMonth()];return e?WEEK_DAY_NAMES[i.getDay()]+", "+n:n}let mouseLockedByScroller=!1;class AnimationManager{constructor(){this.animationsInProgress_={},this.rafId_=null,this.loopBound_=this.loop_.bind(this)}isInProgress(t){return!!this.animationsInProgress_[t]}getAnimationInfo(t){return this.animationsInProgress_[t]}run(t){const{id:e,startValue:i,endValue:n}=t,s=this.animationsInProgress_[e];if(s){if(s.endValue===n)return;const i=s.currentValue;this.animationsInProgress_[e]={...t,startValue:i,startTime:performance.now(),currentValue:i}}else this.animationsInProgress_[e]={...t,startTime:performance.now(),currentValue:i};this.maybeRunAnimationsLoop_()}cancel(t){delete this.animationsInProgress_[t]}maybeRunAnimationsLoop_(){this.rafId_||(this.rafId_=requestAnimationFrame(this.loopBound_))}loop_(t){const e=new Set;for(const i of Object.keys(this.animationsInProgress_)){const{target:n,startValue:s,endValue:o,startTime:a,duration:h,action:r}=this.animationsInProgress_[i],l=Math.min(t-a,h);if(l<0)continue;const d=Math.min(1,l/h),c=s+(o-s)*(t=>t*(2-t))(d);r(Math.round(1e3*c)/1e3),e.add(n),1===d?delete this.animationsInProgress_[i]:this.animationsInProgress_[i]={...this.animationsInProgress_[i],currentValue:c}}if(e.size)for(let t of e)t.draw();Object.keys(this.animationsInProgress_).length?this.rafId_=requestAnimationFrame(this.loopBound_):(cancelAnimationFrame(this.rafId_),this.rafId_=null)}static getInstance(){return this.instance||(this.instance=new AnimationManager),this.instance}}class ChartTable extends HTMLElement{static get is(){return"chart-table"}constructor(t){super();const e=[.75,1];this.datasets_=t;const i=this.attachShadow({mode:"open"}),n=new ChartPlot(t,"main-plot",e,!0);i.appendChild(n);const s=new ChartScrollbar(t,e,n);i.appendChild(s);const o=new ChartFilter(t);i.appendChild(o),o.addEventListener("checkbox-change",t=>{s.toggleFilter(t.detail),n.toggleLine(t.detail)}),this.plot=n,this.scrollbar_=s}resize(){this.plot.resize(),this.scrollbar_.resize()}}customElements.define(ChartTable.is,ChartTable);const Bar=Object.freeze({FIRST:"first",SECOND:"second",THIRD:"third"}),TOPLINE_MARGIN_PX=20,DATE_STRING_WIDTH=90,DATE_HIDING_START=.2;class ChartPlot extends HTMLElement{static get is(){return"chart-plot"}constructor(t,e,i,n){super(),this.dataset_=t,this.name_=e,this.showAxes_=n,this.paddingTop_=this.showAxes_?20:3,this.paddingLeftRight_=this.showAxes_?18:0,this.dataX_=t.columns.find(t=>"x"===t[0]),this.dotsCount_=this.dataX_.length-1,this.lastDotIndex_=this.dotsCount_,this.updateDimensions_();const s=this.getLineColumns_(),o={};for(let t of s.keys())o[t]=!0;this.finalState_={visibleLines:o,range:i},this.reselection_=this.reselectValues_(this.finalState_);const a={};for(let t of s.keys())a[t]=1;this.animationState_={linesOpacity:a,height:this.reselection_.height,[Bar.FIRST]:{scale:1,opacity:1,height:this.reselection_.height},[Bar.SECOND]:{scale:1,opacity:0,height:this.reselection_.height},[Bar.THIRD]:{scale:1,opacity:0,height:this.reselection_.height},middleDatesOpacity:this.getStaticMiddleDatesOpacity_()},this.maxDigits_=(this.reselection_.height+"").length,this.shadowRoot_=this.attachShadow({mode:"open"}),this.onMouseEnterBound_=this.onMouseEnter_.bind(this),this.onMouseMoveBound_=this.onMouseMove_.bind(this),this.onMouseLeaveBound_=this.onMouseLeave_.bind(this),this.touchStartId_=null,this.touchStartY_=null,this.touchStartTimeout_=null,this.pointerVisible_=!1,this.onTouchStartBound_=this.onTouchStart_.bind(this),this.onTouchMoveBound_=this.onTouchMove_.bind(this),this.onTouchEndBound_=this.onTouchEnd_.bind(this),this.dotsCount_>200&&(this.simplifiedDataset_=simplifyDataset(t))}connectedCallback(){this.style.display="block",this.style.overflow="hidden",this.style.position="relative",this.canvas_=document.createElement("canvas"),this.ctx_=this.canvas_.getContext("2d"),this.updateCanvasSize_(),this.shadowRoot_.appendChild(this.canvas_),this.showAxes_&&(this.appendTopShadow_(),this.addEventListener("mouseenter",this.onMouseEnterBound_),this.addEventListener("touchstart",this.onTouchStartBound_,!0)),this.draw()}onMouseEnter_(t){null===this.touchStartId_&&this.hasVisibleLines_&&(this.createPointerIfNeeded_(),this.addEventListener("mousemove",this.onMouseMoveBound_),this.addEventListener("mouseleave",this.onMouseLeaveBound_))}onTouchStart_(t){if(!this.hasVisibleLines_)return;const e=t.changedTouches[0];this.touchStartId_=e.identifier,this.touchStartY_=e.clientY,this.touchStartTimeout_=setTimeout(()=>{this.pointerVisible_=!0,this.createPointerIfNeeded_(),this.movePointer_(e.clientX)},120),this.addEventListener("touchmove",this.onTouchMoveBound_,!0),this.addEventListener("touchend",this.onTouchEndBound_,!0)}onMouseMove_(t){mouseLockedByScroller||this.movePointer_(t.clientX)}onTouchMove_(t){const e=this.getTouch_(t,this.touchStartId_);e?this.pointerVisible_?(this.movePointer_(e.clientX),t.preventDefault()):Math.abs(e.clientY-this.touchStartY_)>10&&this.hidePointerAndClearTouch_():this.hidePointerAndClearTouch_()}onMouseLeave_(t){this.pointer_.style.opacity=0,this.removeEventListener("mousemove",this.onMouseMoveBound_),this.removeEventListener("mouseleave",this.onMouseLeaveBound_)}onTouchEnd_(t){this.hidePointerAndClearTouch_(),t.preventDefault()}getTouch_(t,e){for(const i of t.changedTouches)if(i.identifier===e)return i;return null}hidePointerAndClearTouch_(){this.pointer_&&(this.pointer_.style.opacity=0),this.pointerVisible_=!1,this.touchStartId_=null,this.touchStartY_=null,clearInterval(this.touchStartTimeout_),this.touchStartTimeout_=null,this.removeEventListener("touchmove",this.onTouchMoveBound_),this.removeEventListener("touchend",this.onTouchEndBound_)}createPointerIfNeeded_(){if(this.pointer_)return;const t=this.getLineColumns_();this.pointer_=new ChartPointer(t,this.maxDigits_),this.pointer_.style.opacity=0,this.shadowRoot.appendChild(this.pointer_)}get hasVisibleLines_(){for(const t of Object.keys(this.finalState_.visibleLines))if(this.finalState_.visibleLines[t])return!0;return!1}movePointer_(t){const[e,i]=this.getPointingIndex_(t),n=this.dataset_,s=n.columns.find(t=>"x"===t[0]),o={};o.left=i,o.date=s[e],o.dots=[];for(const t of n.columns){const i=t[0];if("x"===i)continue;const s=t[e],a=this.reselection_.height,h=this.getDotPosY_(s,a);o.dots.push({key:i,isVisible:this.finalState_.visibleLines[i],value:s,color:n.colors[i],name:n.names[i],top:h})}this.pointer_.update(o),this.pointer_.style.opacity=1}getPointingIndex_(t){const e=this.reselection_.visibleDotsRangeRaw,i=Math.max(0,Math.min(this.plotWidth_,t-this.paddingLeftRight_))/this.plotWidth_,n=Math.round(e[0]+(e[1]-e[0])*i)+1,s=Math.max(Math.ceil(e[0]+1),Math.min(Math.floor(e[1]+1),n)),o=this.plotWidth_/(e[1]-e[0]),a=this.paddingLeftRight_+o*(s-e[0]-1);return[s,Math.floor(a)]}updateDimensions_(){this.canvasWidth_=this.showAxes_?baseDimensions.windowWidth:baseDimensions.scrollbarPlotWidth,this.canvasHeight_=this.showAxes_?baseDimensions.mainPlotHeight:baseDimensions.scrollbarPlotHeight,this.plotWidth_=this.showAxes_?baseDimensions.windowWidth-2*this.paddingLeftRight_:baseDimensions.scrollbarPlotWidth,this.plotHeight_=this.showAxes_?baseDimensions.mainPlotHeight-33:baseDimensions.scrollbarPlotHeight,this.plotRenderingZoneHeight_=this.plotHeight_-this.paddingTop_,this.stepWidthOnFullScale_=this.plotWidth_/(this.dotsCount_-1)}updateCanvasSize_(){const t=this.canvasWidth_,e=this.canvasHeight_;this.canvas_.width=2*t,this.canvas_.height=2*e,this.canvas_.style.width=`${t}px`,this.canvas_.style.height=`${e}px`,this.ctx_.scale(2,2)}resize(){this.updateDimensions_(),this.reselection_=this.reselectValues_(this.finalState_),this.updateCanvasSize_(),this.animationState_.middleDatesOpacity=this.getStaticMiddleDatesOpacity_(),this.draw()}getStaticMiddleDatesOpacity_(){return this.reselection_.progressToNextDatesStep>DATE_HIDING_START?0:1}appendTopShadow_(){const t=document.createElement("div");t.id="shadow",t.display="block",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="20px",t.style.position="absolute",t.style.background="var(--chart-shadow)",t.style.willChange="opacity",this.shadowRoot.appendChild(t)}reselectValues_(t){const{range:e,visibleLines:i}=t,n=this.selectVisibleDotsRangeRaw_(e),s=[Math.ceil(n[0]+1),Math.floor(n[1]+1)],o=this.finalState_.range[1]-this.finalState_.range[0],a=this.stepWidthOnFullScale_*(1/o),h=this.selectVisibleMaxDot_(s,i,a)||this.reselection_.height,r=Math.floor(this.plotWidth_/DATE_STRING_WIDTH),l=Math.floor(this.dotsCount_/r)*o,d=this.getClosestPowerOfTwo_(l),c=(l-d)/d;return{height:h,rangeDiff:o,visibleDotsRange:s,visibleDotsRangeRaw:n,stepWidthOnCurrentZoom:a,dotsToSkip:d,dotsInZoomedStep:l,datesStepPassed:c>DATE_HIDING_START,progressToNextDatesStep:c}}getClosestPowerOfTwo_(t){let e=1;for(let i=1;i<=1*Math.floor(t);i*=2)e=i;return e}toggleLine({key:t,checked:e}){if(this.finalState_.visibleLines[t]===e)return;this.finalState_.visibleLines[t]=e;const i=this.reselectValues_(this.finalState_);i.height!==this.reselection_.height&&(this.runHeightAnimation_(this.reselection_.height,i.height),this.runAxeYAnimation_(this.reselection_.height,i.height)),this.runLineOpacityAnimation_(t,e?[0,1]:[1,0]),this.reselection_=i}setRange(t){if(this.finalState_.range&&this.finalState_.range[0]===t[0]&&this.finalState_.range[1]===t[1])return;this.finalState_.range=t;const e=this.reselectValues_(this.finalState_);e.height!==this.reselection_.height&&(this.runHeightAnimation_(this.reselection_.height,e.height),this.runAxeYAnimation_(this.reselection_.height,e.height)),e.datesStepPassed!==this.reselection_.datesStepPassed&&(e.dotsToSkip!==this.reselection_.dotsToSkip?(AnimationManager.getInstance().cancel(`${this.name_}-dates`),this.animationState_.middleDatesOpacity=e.dotsToSkip>this.reselection_.dotsToSkip?1:0):this.runMiddleDateAnimation_(!e.datesStepPassed)),AnimationManager.getInstance().isInProgress(`${this.name_}-height`)||this.scheduleDraw_(),this.reselection_=e}runMiddleDateAnimation_(t){const e=t?[0,1]:[1,0];AnimationManager.getInstance().run({startValue:e[0],endValue:e[1],target:this,id:`${this.name_}-dates`,duration:t?500:300,action:t=>{this.animationState_.middleDatesOpacity=t}})}runHeightAnimation_(t,e){AnimationManager.getInstance().run({startValue:t,endValue:e,target:this,id:`${this.name_}-height`,duration:SCALING_DURATION,action:t=>{this.animationState_.height=t}})}runLineOpacityAnimation_(t,[e,i]){AnimationManager.getInstance().run({startValue:e,endValue:i,target:this,id:`${this.name_}-opacity-${t}`,duration:SCALING_DURATION,action:e=>{this.animationState_.linesOpacity[t]=e}})}runYAxeOpacityAnimation_(t,[e,i],n){AnimationManager.getInstance().run({startValue:e,endValue:i,target:this,id:`${this.name_}-${t}-bar-opacity`,duration:n||SCALING_DURATION,action:e=>{this.animationState_[t].opacity=e}})}runYAxeScaleAnimation_(t,[e,i]){AnimationManager.getInstance().run({startValue:e,endValue:i,target:this,id:`${this.name_}-${t}-bar-scale`,duration:SCALING_DURATION,action:e=>{this.animationState_[t].scale=e}})}runAxeYAnimation_(t,e){if(!this.showAxes_)return;let i=e/t;(i>1?i:1/i)<1.12&&(i=1);const n={scale:[i,1],opacity:[0,1]},s={scale:[1,1/i],opacity:[1,0]};if(this.toAppear_||this.toDisappear_||this.toFree_||(this.toAppear_=Bar.FIRST,this.toDisappear_=Bar.SECOND,this.toFree_=Bar.THIRD),1===i)this.animationState_[this.toAppear_].height=e,this.runYAxeScaleAnimation_(this.toAppear_,n.scale),this.runYAxeOpacityAnimation_(this.toAppear_,n.opacity),this.animationState_[this.toDisappear_].height=t,this.runYAxeScaleAnimation_(this.toDisappear_,s.scale),this.runYAxeOpacityAnimation_(this.toDisappear_,s.opacity);else{const i=this.toAppear_,o=this.toDisappear_,a=this.toFree_;this.toAppear_=a,this.toDisappear_=i,this.toFree_=o,AnimationManager.getInstance().cancel(`${this.name_}-${this.toAppear_}-bar-scale`),AnimationManager.getInstance().cancel(`${this.name_}-${this.toAppear_}-bar-opacity`),this.animationState_[this.toAppear_].height=e,this.runYAxeScaleAnimation_(this.toAppear_,n.scale),this.runYAxeOpacityAnimation_(this.toAppear_,n.opacity),this.animationState_[this.toDisappear_].height=t,this.runYAxeScaleAnimation_(this.toDisappear_,s.scale),this.runYAxeOpacityAnimation_(this.toDisappear_,s.opacity)}}scheduleDraw_(){this.drawScheduled_||(this.drawScheduled_=!0,requestAnimationFrame(()=>{this.drawScheduled_=!1,this.draw()}))}draw(){const t=this.ctx_;t.clearRect(0,0,this.canvasWidth_,this.canvasHeight_),t.save();const{visibleDotsRange:e,stepWidthOnCurrentZoom:i}=this.reselection_,n=Math.ceil(60/i),s=Math.max(1,e[0]-n),o=Math.min(this.lastDotIndex_,e[1]+n),a=(s-1)*i,h=this.finalState_.range[0]*i*(this.dataX_.length-2)-a-this.paddingLeftRight_;t.translate(-h,0),this.showAxes_&&this.drawAxeX_(t,s,o);for(const e of this.dataset_.columns){const i=e[0];if("x"!==i){const n=e;let a=null;this.simplifiedDataset_&&this.reselection_.dotsInZoomedStep>75&&(a=null),this.drawLine_(t,i,n,s,o,a)}0}t.restore(),this.showAxes_&&this.drawAxeY_(t)}drawAxeY_(t){t.beginPath(),t.strokeStyle=theme===Theme.LIGHT?"#f2f4f5":"#313f52",t.globalAlpha=1,t.lineWidth=1;const e=(this.plotRenderingZoneHeight_-TOPLINE_MARGIN_PX)/5;this.drawAxeYLine_(t,0,e,{height:0,scale:1,opacity:1});for(let i=1;i<6;i++)this.drawAxeYLine_(t,i,e,this.animationState_[Bar.FIRST]);for(let i=1;i<6;i++)this.drawAxeYLine_(t,i,e,this.animationState_[Bar.SECOND]);for(let i=1;i<6;i++)this.drawAxeYLine_(t,i,e,this.animationState_[Bar.THIRD])}drawAxeYLine_(t,e,i,{scale:n,opacity:s,height:o}){t.globalCompositeOperation="destination-over",t.beginPath(),t.globalAlpha=s;const a=this.plotHeight_-e*i*n;t.moveTo(0+this.paddingLeftRight_,a),t.lineTo(this.paddingLeftRight_+this.plotWidth_,a),t.stroke(),t.globalCompositeOperation="source-over";const h=i/this.plotRenderingZoneHeight_,r=Math.floor(o*e*h);t.textAlign="left",t.fillStyle=theme===Theme.LIGHT?"#96a2aa":"#546778",t.font=`${fontWeight} 14px ${fontFamily}`,t.fillText(formatNumber(r,this.maxDigits_),this.paddingLeftRight_,a-10)}drawAxeX_(t,e,i){const{dotsToSkip:n,stepWidthOnCurrentZoom:s}=this.reselection_,o=Math.ceil(DATE_STRING_WIDTH/s),a=Math.min(this.lastDotIndex_,i+o);for(let i=e;i<=a;i++){const o=(i-e)*s,a=this.lastDotIndex_-i;if(a%n!=0)continue;const h=a/n%2==1;t.globalAlpha=h?this.animationState_.middleDatesOpacity:1,t.textAlign="right",t.fillStyle=theme===Theme.LIGHT?"#96a2aa":"#546778",t.font=`${fontWeight} 14px ${fontFamily}`,t.fillText(getDateString(this.dataX_[i]),o,450)}}drawLine_(t,e,i,n,s,o){const{stepWidthOnCurrentZoom:a}=this.reselection_,h=this.animationState_.linesOpacity[e],r=this.dataset_.colors[e],l=this.animationState_.height;if(t.beginPath(),t.strokeStyle=r,t.globalAlpha=h,t.lineWidth=this.showAxes_?2.8:1.3,t.lineJoin="round",t.lineCap="round",o){let e=!1;for(let h=0;h<=o.length-1;h++){const r=o[h];!e&&r>=n?(this.pointDot_(t,n,n,i,l,a),e=!0):r>n&&r<s&&this.pointDot_(t,r,n,i,l,a)}this.pointDot_(t,s,n,i,l,a)}else for(let e=n;e<=s;e++)this.pointDot_(t,e,n,i,l,a);t.stroke()}pointDot_(t,e,i,n,s,o){const a=n[e],h=this.getDotPosY_(a,s),r=e-i,l=r*o;t[0===r?"moveTo":"lineTo"](l,h)}selectVisibleDotsRangeRaw_(t){const[e,i]=t,n=this.dataset_.columns.find(t=>"x"===t[0]).length-2;return[n*e,n*i]}selectVisibleMaxDot_(t,e,i){const[n,s]=t,o=this.dataset_,a=Math.ceil(10/i),h=Math.max(0,n-a),r=Math.min(this.lastDotIndex_,s+a);let l=0,d=0,c=0;const _=o.columns;for(let t=0;t<_.length;t++){const i=_[t];if(e[i[0]])for(let e=h;e<=r;e++)i[e]>l&&(l=i[e],d=e,c=t)}if(0===l)return 0;const u=Math.ceil(25/i),p=Math.max(0,d-u),m=Math.min(this.lastDotIndex_,d+u);let g=l;for(let t=p;t<=m;t++)_[c][t]>g&&(g=_[c][t]);return this.showAxes_?Math.ceil(this.moveMaxForRoundYAxeTopValue_(g)):g}moveMaxForRoundYAxeTopValue_(t){const e=1-TOPLINE_MARGIN_PX/this.plotRenderingZoneHeight_,i=Math.max(10,Math.pow(10,(t+"").length-2));return t*(Math.ceil(t*e/i)*i/(t*e))}getDotPosY_(t,e){const i=this.plotRenderingZoneHeight_;return i+this.paddingTop_-Math.round(i*(t/e))}getLineColumns_(){const t=this.dataset_,e=new Set;for(let i of Object.keys(t.types))"line"===t.types[i]&&e.add(i);return e}}customElements.define(ChartPlot.is,ChartPlot);const WindowZone=Object.freeze({BORDER_LEFT:"left-border",BORDER_RIGHT:"right-border",ITSELF:"itself"}),SCROLLBAR_WINDOW_PADDING=10,SCROLLBAR_MARGIN=18,SCROLLBAR_MIN_RANGE=.25,scrollbarTemplate=document.createElement("template");scrollbarTemplate.innerHTML=`\n<style>\n:host {\n  display: flex;\n  height: 57px;\n  position: relative;\n  margin: 10px ${SCROLLBAR_MARGIN}px 0;\n  overflow: hidden;\n}\n\n#window {\n  position: absolute;\n  height: 100%;\n  padding: 0 10px;\n  box-sizing: border-box;\n}\n\n#window-frame {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n\n#window-frame-border {\n  border: 1px solid var(--chart-scrollbar-window-color);\n  border-left-width: 6px;\n  border-right-width: 6px;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n}\n\n#window-shadow-left,\n#window-shadow-right {\n  content: '';\n  height: 100%;\n  width: 100vw;\n  background-color: var(--chart-scrollbar-paranja-color);\n  opacity: 0.8;\n  position: absolute;\n  top: 0;\n  pointer-events: none;\n}\n\n#window-shadow-left {\n  right: 100%;\n}\n\n#window-shadow-right {\n  left: 100%;\n}\n\n#plot {\n  position: absolute;\n  top: 1px;\n  left: 0;\n}\n</style>\n<div id="window">\n  <div id="window-frame">\n    <div id="window-shadow-left"></div>\n    <div id="window-frame-border"></div>\n    <div id="window-shadow-right"></div>\n  </div>\n</div>\n`;class ChartScrollbar extends HTMLElement{static get is(){return"chart-scrollbar"}constructor(t,e,i){super(),this.initialRange_=e,this.mainPlot_=i;const n=this.attachShadow({mode:"open"});n.appendChild(scrollbarTemplate.content.cloneNode(!0)),this.window_=this.shadowRoot.querySelector("#window"),this.plot_=new ChartPlot(t,"scrollbar-plot",[0,1],!1),this.plot_.id="plot",this.plot_.datasets=t,n.prepend(this.plot_),this.onMouseDownBound_=this.onMouseDown_.bind(this),this.onMouseUpBound_=this.onMouseUp_.bind(this),this.onMouseMoveBound_=this.onMouseMove_.bind(this),this.touchStartId_=null,this.onTouchStartBound_=this.onTouchStart_.bind(this),this.onTouchMoveBound_=this.onTouchMove_.bind(this),this.onTouchEndBound_=this.onTouchEnd_.bind(this),this.updateWindowPositionBound_=this.updateWindowPosition_.bind(this),this.updateWindowPositionScheduled_=!1}connectedCallback(){this.window_.addEventListener("mousedown",this.onMouseDownBound_),this.window_.addEventListener("touchstart",this.onTouchStartBound_),this.range=this.initialRange_}set isDragging(t){this.isDragging_!==t&&(this.isDragging_=t,t?(mouseLockedByScroller=!0,document.addEventListener("mousemove",this.onMouseMoveBound_),document.addEventListener("mouseup",this.onMouseUpBound_)):(mouseLockedByScroller=!1,document.removeEventListener("mousemove",this.onMouseMoveBound_),document.removeEventListener("mouseup",this.onMouseUpBound_)))}get isDragging(){return this.isDragging_}set isSliding(t){this.isSliding_!==t&&(this.isSliding_=t,t?(document.addEventListener("touchmove",this.onTouchMoveBound_),document.addEventListener("touchend",this.onTouchEndBound_)):(this.touchStartId_=null,document.removeEventListener("touchmove",this.onTouchMoveBound_),document.removeEventListener("touchend",this.onTouchEndBound_)))}get isSliding(){return this.isSliding_}set range(t){this.range_&&this.range_[0]===t[0]&&this.range_[1]===t[1]||(this.range_=t,this.scheduleWindowPositionUpdate_())}get range(){return this.range_}onMouseDown_(t){if(0!==t.button)return;this.isDragging=!0;const e=t.clientX;this.startPointing_(e)}onTouchStart_(t){this.isSliding=!0;const e=t.changedTouches[0];this.touchStartId_=e.identifier,this.startPointing_(e.clientX),t.preventDefault()}startPointing_(t){const e=this.window_.getBoundingClientRect(),i=t-e.left,n=SCROLLBAR_WINDOW_PADDING+13;let s;s=i<=n?WindowZone.BORDER_LEFT:i>=e.width-n?WindowZone.BORDER_RIGHT:WindowZone.ITSELF,this.startRelativeLeft_=t-SCROLLBAR_MARGIN,this.startRage_=this.range,this.startDragZone_=s}onMouseMove_(t){0!==t.buttons?(this.updateRangeFromPointerPosition_(t.clientX),t.preventDefault()):this.isDragging=!1}onTouchMove_(t){const e=this.getTouch_(t,this.touchStartId_);e?this.updateRangeFromPointerPosition_(e.clientX):this.isSliding=!1}onMouseUp_(t){this.isDragging=!1}onTouchEnd_(t){this.isSliding=!1}getTouch_(t,e){for(const i of t.changedTouches)if(i.identifier===e)return i;return null}updateRangeFromPointerPosition_(t){const e=(t-SCROLLBAR_MARGIN-this.startRelativeLeft_)/baseDimensions.scrollbarWidth;let i;switch(this.startDragZone_){case WindowZone.ITSELF:{const t=(i=[this.startRage_[0]+e,this.startRage_[1]+e])[1]-i[0];i[0]<0&&(i=[0,t]),i[1]>1&&(i=[1-t,1]);break}case WindowZone.BORDER_LEFT:(i=[this.startRage_[0]+e,this.startRage_[1]])[1]-i[0]<SCROLLBAR_MIN_RANGE&&(i[0]=i[1]-SCROLLBAR_MIN_RANGE),i[0]<0&&(i[0]=0);break;case WindowZone.BORDER_RIGHT:(i=[this.startRage_[0],this.startRage_[1]+e])[1]-i[0]<SCROLLBAR_MIN_RANGE&&(i[1]=i[0]+SCROLLBAR_MIN_RANGE),i[1]>1&&(i[1]=1)}this.range=[round(i[0],4),round(i[1],4)],this.mainPlot_.setRange(this.range)}scheduleWindowPositionUpdate_(){this.updateWindowPositionScheduled_||(this.updateWindowPositionScheduled_=!0,requestAnimationFrame(this.updateWindowPositionBound_))}updateWindowPosition_(){if(!this.updateWindowPositionScheduled_)return;if(this.updateWindowPositionScheduled_=!1,null===this.range)return;const t=Math.floor(baseDimensions.scrollbarWidth*this.range[0]),e=Math.ceil(baseDimensions.scrollbarWidth*this.range[1])-t;this.window_.style.transform=`translateX(${t-SCROLLBAR_WINDOW_PADDING}px)`,this.window_.style.width=`${e+2*SCROLLBAR_WINDOW_PADDING}px`}toggleFilter(t){this.plot_.toggleLine(t)}resize(){this.plot_.resize(),this.scheduleWindowPositionUpdate_()}}customElements.define(ChartScrollbar.is,ChartScrollbar);class ChartFilter extends HTMLElement{static get is(){return"chart-filter"}constructor(t){super();this.attachShadow({mode:"open"});for(const e of Object.keys(t.names)){const i=t.names[e],n=t.colors[e],s=new ChartCheckbox(i,n,!0);this.shadowRoot.appendChild(s),s.addEventListener("change",t=>{this.dispatchEvent(new CustomEvent("checkbox-change",{detail:{key:e,checked:t.detail.checked},composed:!0,bubbles:!0}))})}}}customElements.define(ChartFilter.is,ChartFilter);const checkboxTemplate=document.createElement("template");checkboxTemplate.innerHTML=`\n<style>\n:host {\n  display: inline-block;\n  cursor: pointer;\n  margin: 23px 3px 0 18px;\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n#container {\n  height: 48px;\n  line-height: 48px;\n  padding: 0 19px 0 9px;\n  border: 1px solid var(--chart-checkbox-border-color);\n  border-radius: 24px;\n  display: flex;\n  align-items: center;\n  color: var(--chart-checkbox-text-color);\n\n  font-family: ${fontFamily};\n  font-weight: ${fontWeight};\n  font-size: 19px;\n}\n\n#checkmark {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  display: block;\n  margin-right: 13px;\n  position: relative;\n}\n\n#checkmark svg {\n  height: 14px;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin: -6px 0 0 -9px;\n\n  transform-origin: center bottom;\n  transition: transform 0.2s;\n}\n\n#checkmark:before {\n  content: '';\n  position: absolute;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  background: #edf1f6;\n  opacity: 0.5;\n  z-index: -1;\n  top: 10px;\n  left: 10px;\n\n  opacity: 1;\n  transform-origin: center center;\n  transform: scale(1, 1);\n  transition: transform 0.25s;\n  display: none;\n}\n\n#checkmark:after {\n  content: '';\n  position: absolute;\n  width: 26px;\n  height: 26px;\n  border-radius: 50%;\n  background: var(--chart-checkbox-checkmark-background);\n  top: 2px;\n  left: 2px;\n\n  transform-origin: center center;\n  transition: transform 0.25s;\n}\n\n:host([checked]) #checkmark:after {\n  transform: scale(0, 0);\n}\n\n:host(:not([checked])) #checkmark svg {\n  transform: scale(0, 0);\n}\n\n</style>\n<div id="container">\n  <span id="checkmark">\n  <svg viewBox="0 0 36 28" xmlns="http://www.w3.org/2000/svg"> \n    <line x1="6" y1="14" x2="13" y2="22" stroke="white"\n          stroke-linecap="round"  stroke-width="6" /> \n    <line x1="13" y1="22" x2="30" y2="5" stroke="white"\n          stroke-linecap="round" stroke-width="6"/> \n  </svg>\n  </span>\n  <span id="title"></span>\n</div>\n`;class ChartCheckbox extends HTMLElement{static get is(){return"chart-checkbox"}constructor(t,e,i){super(),this.checked=i;const n=this.attachShadow({mode:"open"});n.appendChild(checkboxTemplate.content.cloneNode(!0)),n.querySelector("#title").textContent=t,n.querySelector("#checkmark").style.backgroundColor=e}connectedCallback(){this.addEventListener("click",this.onClick_)}set checked(t){Boolean(t)?this.setAttribute("checked",""):this.removeAttribute("checked")}get checked(){return this.hasAttribute("checked")}onClick_(){this.checked=!this.checked,this.dispatchEvent(new CustomEvent("change",{detail:{checked:this.checked},bubbles:!0}))}}customElements.define(ChartCheckbox.is,ChartCheckbox);class ChartThemeSwitcher extends HTMLElement{static get is(){return"chart-theme-switcher"}constructor(){super(),this.text_=document.createElement("span"),this.appendChild(this.text_),this.style.display="block",this.style.margin="70px 0 45px",this.style.textAlign="center",this.text_.style.display="inline-block",this.text_.style.font=`300 25px ${fontFamily}`,this.text_.style.cursor="pointer",this.text_.style.margin="0 auto",this.text_.style.userSelect="none",this.onClickBound_=this.onClick_.bind(this),this.updateText_()}connectedCallback(){this.text_.addEventListener("click",this.onClickBound_)}set theme(t){theme=t,this.text_&&this.updateText_(),document.body.setAttribute("theme",t);for(let t of document.querySelectorAll("chart-table"))t.plot&&t.plot.draw()}get theme(){return theme}onClick_(){this.toggleTheme()}toggleTheme(){this.theme=this.theme===Theme.LIGHT?Theme.DARK:Theme.LIGHT}updateText_(){this.theme===Theme.LIGHT?(this.text_.innerText="Switch to Night Mode",this.text_.style.color="#108be3"):(this.text_.innerText="Switch to Day Mode",this.text_.style.color="#36a8f1")}}customElements.define(ChartThemeSwitcher.is,ChartThemeSwitcher);const pointerTemplate=document.createElement("template");pointerTemplate.innerHTML='\n  <style>\n  :host {\n    width: 1px;\n    height: 427px;\n    position: absolute;\n    left: 10px;\n    top: 0;\n  }\n  #line {\n    height: calc(100% - 96px);\n    margin-top: 96px;\n    width: 1px;\n    background: var(--chart-pointer-color);\n    position: absolute;\n  }\n  .dot {\n    width: 15px;\n    height: 15px;\n    background: var(--chart-page-background);\n    box-sizing: border-box;\n    border-radius: 50%;\n    border: 3px solid black;\n    position: absolute;\n    margin: -7px 0 0 -7px;\n  }\n  </style>\n  <div id="line"></div>\n';class ChartPointer extends HTMLElement{static get is(){return"chart-pointer"}constructor(t,e){super(),this.attachShadow({mode:"open"}).appendChild(pointerTemplate.content.cloneNode(!0)),this.dots_={};for(const e of t){const t=document.createElement("div");t.classList.add("dot"),this.dots_[e]=t,this.shadowRoot.appendChild(t)}this.bubble_=new ChartPointerBubble(t,e),this.shadowRoot.appendChild(this.bubble_)}update(t){this.style.left=`${t.left}px`;for(const{key:e,isVisible:i,color:n,top:s}of t.dots){const t=this.dots_[e];t.hidden=!i,t.style.top=`${s}px`,t.style.borderColor=n}this.bubble_.update(t)}}customElements.define(ChartPointer.is,ChartPointer);const BUBBLE_MARGIN=-37,BUBBLE_WINDOW_PADDING=10,pointerBubbleTemplate=document.createElement("template");pointerBubbleTemplate.innerHTML=`\n  <style>\n  :host {\n    display: inline-block;\n    border-radius: 6px;\n    box-shadow: 0 1px 3px var(--chart-bubble-shadow-color);\n    padding: 9px 15px;\n    background: var(--chart-bubble-background);\n    margin-left: ${BUBBLE_MARGIN}px;\n    margin-top: 3px;\n    position: relative;\n    font-family: ${fontFamily};\n    min-width: 105px;\n  }\n\n  #date {\n    font-size: 18px;\n    color: var(--chart-bubble-date-color);\n    margin-bottom: 3px;\n  }\n\n  #lines {\n    margin-left: -15px;\n  }\n\n  .line {\n    margin-top: 10px;\n    margin-left: 15px;\n    display: inline-block;\n    min-width: 40px;\n  }\n\n  .line[hidden] {\n    display: none;\n  }\n\n  .line__value {\n    display: block;\n    font-weight: 600;\n    font-size: 19px;\n    margin-bottom: 1px;\n  }\n\n  .line__name {\n    display: block;\n    font-size: 14px;\n  }\n  </style>\n  <div id="date">Sat, Fab 24</div>\n  <div id="lines"></div>\n`;const pointerBubbleLineTemplate=document.createElement("template");pointerBubbleLineTemplate.innerHTML='\n  <span class="line__value"></span>\n  <span class="line__name"></span>\n';class ChartPointerBubble extends HTMLElement{static get is(){return"chart-pointer-bubble"}constructor(t,e){super(),this.maxDigits_=e,this.attachShadow({mode:"open"}).appendChild(pointerBubbleTemplate.content.cloneNode(!0)),this.date_=this.shadowRoot.querySelector("#date"),this.lines_=this.shadowRoot.querySelector("#lines"),this.linesByKey_={};const i=this.getLineMinWidth_(e);for(const e of t){const t=document.createElement("span");t.classList.add("line"),t.style.minWidth=`${i}px`,t.appendChild(pointerBubbleLineTemplate.content.cloneNode(!0)),this.lines_.appendChild(t),this.linesByKey_[e]=t}this.lines_.style.width=`${2*(i+15)}px`}update(t){this.date_.textContent=getDateString(t.date,!0);for(const e of t.dots){const t=this.linesByKey_[e.key];e.isVisible?(t.hidden=!1,t.style.color=e.color,t.querySelector(".line__value").innerText=formatNumber(e.value,this.maxDigits_),t.querySelector(".line__name").innerText=e.name):t.hidden=!0}const e=t.left+BUBBLE_MARGIN,i=e+this.offsetWidth,n=Math.max(0,i-baseDimensions.windowWidth+BUBBLE_WINDOW_PADDING),s=Math.min(0,e-BUBBLE_WINDOW_PADDING);let o=0;n>0&&(o=n),s<0&&(o=s),this.style.transform=`translateX(${-o}px)`}getLineMinWidth_(t){return t>6?70:t>4?70:t>3?60:40}}function formatNumber(t,e){return 0===t?0:e<7?t.toLocaleString():Math.round(t/1e3).toLocaleString()+"K"}function simplify(t,e){function i([t,e],[i,n],[s,o]){let a=i,h=n,r=s-a,l=o-h;if(0!==r||0!==l){const i=((t-a)*r+(e-h)*l)/(r*r+l*l);i>1?(a=s,h=o):i>0&&(a+=r*i,h+=l*i)}return(r=t-a)*r+(l=e-h)*l}return function(t,e){const n=t.length-1,s=[1];return function t(e,n,s,o,a){let h,r=o;for(let t=n+1;t<s;t++){const o=i([t,e[t]],[n,e[n]],[s,e[s]]);o>r&&(h=t,r=o)}r>o&&(h-n>1&&t(e,n,h,o,a),a.push(h),s-h>1&&t(e,h,s,o,a))}(t,1,n,e,s),s.push(n),s}(t,e*e)}function simplifyDataset(t){const e=[null];for(let i of t.columns)"x"!==i[0]&&e.push(simplify(i,1.5));return e}customElements.define(ChartPointerBubble.is,ChartPointerBubble);
